## 背景
- 终身会员刷新依赖 payment.status，导致永远找不到一次性订单
- 限流逻辑在缺少 Upstash 时直接抛错，生产无法降级
- analyze-web-content 流程重复执行 preflight 校验

## 方案概述
1. 新增 `user_lifetime_memberships` 表，授予终身计划时写入，分发任务读取该表并提供回填脚本
2. 为限流增加 `RATE_LIMIT_REQUIRE_REDIS` 开关，默认允许内存桶降级并输出告警
3. 将分析请求的 preflight 结果透传给 handler，只校验一次

## 执行步骤
1. 数据模型与迁移：定义 membership 表及仓储，支持事务写入
2. 授予与分发逻辑改造：`grantLifetimePlan`、`onOnetimePayment` 写入记录，分发任务查询新表；实现历史回填脚本
3. 限流降级：新增 ENV、调整 `allowInMemoryFallback`，并记录 warn/指标
4. 校验流程重构：导出 `ValidatedAnalyzeRequest`，usecase 执行一次 preflight 并把结果传入 handler，后者只负责抓取与模型调用

