# 依赖健康检查计划

## 背景
- **任务**：检查当前仓库依赖的现状与不足，聚焦版本老旧、潜在冲突、安全漏洞、冗余依赖及覆盖脚本验证。
- **方案**：采用“多源自动化诊断”——结合 pnpm CLI 实际输出、静态配置审查和关键脚本运行结果，形成可执行结论。

## 计划
1. **安装校验**：执行 `pnpm install --frozen-lockfile`，确认锁文件未漂移且可在当前环境完整安装。记录若存在 peer/engine 冲突。
2. **版本漂移扫描**：运行 `pnpm outdated --recursive`，必要时对高优目标使用 `pnpm outdated --filter <pkg>` 深入，识别主依赖/关键库的落后版本。
3. **安全风险审计**：执行 `pnpm audit --production` 与 `pnpm audit --dev`，区分运行时与开发依赖的漏洞等级。
4. **依赖图与 overrides 评估**：使用 `pnpm list --depth 4`（视需要调整深度）及查阅 `pnpm-lock.yaml`，检查是否存在重复主版本、未生效/过时的 `pnpm.overrides` 或潜在的对等依赖错配。
5. **未使用依赖检测**：运行 `pnpm knip`（项目已配置），识别疑似未被引用或脚本多余的依赖。
6. **关键脚本回归**：针对依赖更动敏感的流程运行 `pnpm lint` 与 `pnpm test`（如耗时过长可缩小范围），必要时补跑 `pnpm check:env` 验证环境变量脚本。
7. **结论输出**：统合上述结果，分类整理为“现状”“风险/不足”“建议”，在答复中明确引用命令输出及受影响包。

