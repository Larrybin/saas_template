# 路由与守卫审查报告（静态审查）

## 基线
- 路由守卫一致性、开放重定向防护、单一来源配置。

## 评分矩阵（1–5）
- 正确性与鲁棒性 3.5
- 可读性 4
- 一致性 3
- 复杂度 3.5
- 性能 3
- 安全性 3（依赖 proxy 校验）
- 可测试性 3
- 扩展性 3.5
- 依赖与边界 3.5
- 日志与可观测性 2.5
- 测试覆盖 3

## 发现表（复核 2025-12-09）
- 中 | src/routes.ts:63-108 | `protectedRoutes`/`routesNotAllowedByLoggedInUsers` 仍是手工数组，与 `Routes` 枚举脱节，新增路由需手动同步 | 一致性/正确性 | 基线：单一来源
- 低 | proxy helpers + middleware | 守卫决策仍无结构化日志/metrics（仅返回枚举值） | 可观测性 | 基线：可观测性

## 测试缺口表
- Routes 枚举与 protected/disallowed 同步性。
- 守卫逻辑：登录/未登录、locale、尾斜杠。
- 重定向安全：依赖 proxy 回调校验。

## 建议表
- 高 | 由 Routes 枚举生成 protected/disallowed 列表，保证单一来源 | 依据：routes.ts:70-80
- 中 | 添加守卫决策测试与日志/metrics | 依据：全域缺日志
- 低 | 与 proxy 回调校验联动，统一重定向安全策略 | 依据：proxy 报告

## 简短摘要
风险在于守卫配置分散、缺日志与测试；需单一来源生成守卫列表，补测试与可观测性。***
